
#mpv文档(https://mpv.io/manual/master/)

## 解码

vo=gpu-next

gpu-api=d3d11

hwdec=auto-copy


## 功能

title=${?pause==yes:⏸}${?mute==yes:🔇}${?ontop==yes:📌}${?demuxer-via-network==yes:${media-title}}${?demuxer-via-network==no:${filename}}

osc=no

title-bar=no                          #Windows only

autofit-smaller=50%x50%

idle=yes

snap-window=yes                      #Windows only

log-file="~~/files/mpv.log"

ontop                                   #窗口置顶

hr-seek=yes

hr-seek-framedrop=no                  # 跳转时丢帧，关闭利于修正音频延迟    # SVP 补帧时推荐设置为 no
save-position-on-quit=yes             # 退出时记住播放状态。缓存目录默认在设置文件夹中的 "watch_later"

write-filename-in-watch-later-config

watch-later-dir="~~/cache/watch_later"

watch-later-options=start,vid,aid,sid,sub-scale

save-watch-history=yes

watch-history-path="~~/files/watch_history.jsonl"

autocreate-playlist=filter #auto create playlist

reset-on-next-file=vf,af,brightness,gamma,deinterlace,contrast,hue

input-ipc-server=\\.\pipe\mpvsocket   # input-ipc-server=<ipc_path> 开启 Ipc 功能，Linux/MacOS: input-ipc-server=/tmp/mpvsocket

directory-mode=ignore

## OSD

osd-bar=no

osd-on-seek=msg-bar

osd-bar-w=100

osd-bar-h=2

osd-bar-align-y=-1

osd-font="LXGW WenKai Mono"         # 指定 OSD 字体

osd-font-size=24                      # 更改 OSD 字体大小（全局，影响多个功能显示的文本）（默认值：38）

osd-color="#FFFFFF"                   # OSD 文本主颜色。<格式为 (AA)RRGGBB> AA 为十六进制的透明度，RRGGBB 为十六进制的颜色表示

osd-outline-size=1.0                  # OSD 文本轮廓大小

osd-outline-color="#1C1B1F"           # OSD 文本轮廓颜色

osd-shadow-offset=0                   # OSD 文本字幕阴影大小

osd-back-color="#1C1B1F"              # OSD 文本字幕阴影/背景颜色

osd-border-style=outline-and-shadow   # <默认 outline-and-shadow|opaque-box|background-box> 文本字幕边框的样式

osd-playlist-entry=filename

osd-duration=2000 

## 视频

## 视频用配置组

##音频

audio-device=auto

audio-channels=7.1,5.1,stereo

ao=wasapi

audio-file-auto=fuzzy

## 字幕

sub-codepage=gb18030

sub-auto=fuzzy

sub-scale=0.4

sub-font="LXGW WenKai Momo"


sub-font-size=50                              # 文本字幕字体大小

sub-bold=yes                                  # 文本字幕使用粗体样式

#sub-italic=yes                               # 文本字幕使用斜体样式

sub-color="#FFFFFF"                           # 文本字幕字体颜色。<格式为 (AA)RRGGBB> AA 为十六进制的透明度，RRGGBB 为十六进制的颜色表示

sub-outline-size=0.5                          # 文本字幕轮廓大小

sub-outline-color="#000000"                   # 文本字幕轮廓颜色

sub-shadow-offset=0.5                         # 文本字幕阴影大小

sub-back-color="#000000"                      # 文本字幕阴影/背景颜色


## 截图

### 获取高质量截图

screenshot-format=webp

screenshot-webp-quality=85

screenshot-webp-compression=6

screenshot-tag-colorspace=no 

screenshot-template="C:/Users/darkxch/%{media-title}-%P-%n"

## 脚本 滤镜 着色器

gpu-shader-cache-dir="~~/cache/shaders_cache"  

ytdl-format=bestvideo*+bestaudio/best


##⇘⇘以下为常规配置组启用参数，视需求选择使用
profile=ICC                                  # icc 色彩管理配置组，由操作系统的显示设置指定的 ICC 显示配置文件
#profile=ICC+                                 # icc 色彩管理配置组，使用 color.org 提供的泛 icc 配置文件或专业校色文件，自行选择显示器对应色域的 icc 配置文件
#profile=Target                                # target 色彩管理配置组，不可与 icc 色彩管理共存
profile=Dither                                # 抖动算法配置组（fruit），效果接近 error-diffusion，耗能较低
#profile=Dither+                              # 抖动算法配置组（error-diffusion），误差扩散的色深抖动算法，效果最好也最耗能
profile=Tscale                                # [启用前须先注释 --tscale=<value>] 时域插值算法，具体参数见下方配置区的同名配置
#profile=Tscale+                              # [启用前须先注释 --tscale=<value>] 备选的时域插值算法，具体参数见下方配置区的同名配置
profile=HQ                                    # 最常用的内置算法配置组
profile=DeBand-low                            # [启用前需先注释 --deband] 预设的去色带方案，具体参数见下方配置区的同名配置，接近 madvr 的 deband 设为 low，使用 low 时已有很好的效果
#profile=DeBand-medium                        # [启用前需先注释 --deband] 备选的去色带方案，具体参数见下方配置区的同名配置，接近 madvr 的 deband 设为 medium
#profile=DeBand-high                          # [启用前需先注释 --deband] 备选的去色带方案，具体参数见下方配置区的同名配置，接近 madvr 的 deband 设为 high
profile=HDR2SDR                               # HDR 映射 SDR 参数配置组
                                              # 此配置组不会影响 HDR 设备下的 HDR 直通配置，需要配置 HDR 直通时无需注释此配置组，会影响 SDR 内容的显示
                                              # HDR 直通下依然有可能应用到此配置组中的动态映射和算法（HDR 画面亮度超出显示器峰值亮度时）
#profile=SDR2HDR                              # SDR 映射 HDR 参数配置组，仅在 HDR 显示模式下有效，不推荐启用。仅限--vo=gpu-next 下可用
#profile=SWscaler                             # 备选的软件缩放方案

## 以下为着色器配置组，可按需启用以下所需任一配置组（这将覆盖上面的--glsl-shaders-append 参数）
profile=NNEDI3                                # 适用于大多数场景（NNEDI3-32）               ## 绝大多数场景表现良好，对场景的适应性优于其他配置（抑制锯齿和振铃伪影）。喜欢通用性的优先使用此配置组
#profile=NNEDI3+                              # 适用于大多数场景（NNEDI3-64）               ## 理论上 NNEDI3-64 及以上变体具有更好地抑制振铃伪影效果，但耗能量级倍增，视设备性能自行选择是否使用
#profile=ravu-zoom                            # 适用于大多数场景（ravu-zoom）               ## 放大到目标分辨率，4 倍以上的放大效果不如 mpv 内部的 ewa 类 scale 算法
#profile=FSRCNNX                              # 适用于 HD 场景（FSRCNNX）                   ## 效果类似 madvr 的 NGU Sharp，但产生更多振铃伪影，在低解析画面下表现较差
#profile=FSRCNNX+                             # 适用于 SD 场景（FSRCNNX_distort）           ## 对低解析度的画面具有极好的抑制振铃伪影效果，仍有可能出现涂抹感
#profile=Ani4K                                # 适用于大多数动画（Ani4k V2）                ## 对于瑕疵的处理效果极好，同时尽可能保留原始画风，是比 Anime4K 更优秀的动画着色器。但性能开销极大，请量力使用
#profile=AniSD                                # 适用于 SD 动画（AniSD）                     ## 对于 SD 动画的瑕疵的处理效果极好，同时尽可能保留原始画风，是比 Anime4K 更优秀的动画着色器。但性能开销极大，请量力使用
#profile=Anime4K                              # 适用于大多数动画（Anime4k 去伪影抗锯齿）    ## 对锯齿振铃等瑕疵可以起到较好的抑制效果，仍有明显感知度的涂抹劣化
#profile=SSIM                                 # 适用于低性能消耗

##############
# 常规配置组 #
##############

##⇘⇘常规配置没有自动触发条件（内置配置组也全为常规配置）
##需要主设置文件中使用 --profile=<profile1,profile2,...> 或多行 --profile=<xxx> 参数激活数个配置

[ICC]
 icc-profile=""
 icc-profile-auto
 icc-intent=0
 icc-force-contrast=1000
 icc-3dlut-size=auto
 icc-cache-dir="~~/cache/icc_cache"

[ICC+]
 icc-profile="~~/icc/ITU-RBT709ReferenceDisplay.icc"
 icc-intent=0
 icc-force-contrast=no
 icc-3dlut-size=auto
 icc-cache-dir="~~/cache/icc_cache"

[Target]
 icc-profile=""
 icc-profile-auto=no
 target-prim=auto
 #target-trc=gamma2.2
 #target-peak=203
 target-contrast=auto

[Dither]
 dither-depth=auto
 dither=fruit
 dither-size-fruit=6

[Dither+]
 dither-depth=auto
 dither=error-diffusion
 error-diffusion=floyd-steinberg

[Tscale]
 video-sync=display-resample
 #video-sync-max-video-change=5
 interpolation
 #interpolation-preserve=no
 tscale=oversample

[Tscale+]
 video-sync=display-resample
 #video-sync-max-video-change=5
 interpolation
 #interpolation-preserve=no
 tscale=sphinx
 tscale-blur=0.65

[HQ]
 scale=ewa_lanczossharp
 cscale=bilinear
 dscale=catmull_rom
 scale-antiring=0.5
 dscale-antiring=0.5
 linear-upscaling=no
 sigmoid-upscaling=yes
 correct-downscaling=yes
 linear-downscaling=no
 #scaler-resizes-only=no
 deband=no

[DeBand-low]
 profile-desc=DeBand low
 deband-iterations=1
 deband-threshold=48
 deband-range=16
 deband-grain=16

[DeBand-medium]
 profile-desc=deband medium
 deband-iterations=2
 deband-threshold=64
 deband-range=16
 deband-grain=24

[DeBand-high]
 profile-desc=deband high
 deband-iterations=3
 deband-threshold=64
 deband-range=16
 deband-grain=24

[HDR2SDR]
 profile-desc=HDR-SDR 映射参数
 tone-mapping=auto
 #tone-mapping-param=1.0
 #tone-mapping-max-boost=1.0
 gamut-mapping-mode=auto
 hdr-contrast-recovery=0.30
 #hdr-contrast-smoothness=3.5
 hdr-compute-peak=auto
 hdr-peak-percentile=99.995
 hdr-peak-decay-rate=100
 hdr-scene-threshold-low=5.5
 hdr-scene-threshold-high=10
 allow-delayed-peak-detect=no

[SDR2HDR]
 profile-desc=SDR 反向映射 HDR 参数
 icc-profile=""
 icc-profile-auto=no
 target-prim=auto
 #target-gamut=dci-p3   # 或 adobe，用于 argb 色域
 target-trc=auto
 target-peak=auto  # --gpu-api=vulkan 下必须指定显示器的峰值亮度值，--gpu-api=d3d11 下默认值会自动获取此信息
 target-colorspace-hint=auto
 inverse-tone-mapping=yes

##⇘⇘备选的软件缩放方案
##在 mpv 内部需要执行格式转换时会用到软件缩放器
[SWscaler]
 profile-desc=软件缩放配置
 sws-allow-zimg=no                  # 优先使用 zimg（通常具有更高质量）而不是 libswscale，默认 yes。ffmpeg 经常出现和 zimg 间的兼容性问题，建议禁用
 sws-scaler=bicublin                # [libswscale] <fast-bilinear|bilinear|bicubic 默认|x|point|area|bicublin|gauss|sinc|lanczos|spline>
                                    # [libswscale] 缩放算法（同时作用于色度平面）
 #sws-fast=yes                      # [libswscale] 以质量为代价优化性能，默认 no
 zimg-scaler-chroma=bicubic         # [zimg] <point|bilinear|bicubic|spline16|spline36|lanczos 默认>
                                    # [zimg] 色度还原算法
 #zimg-scaler-chroma-param-a=1/3    # [zimg] 色度还原算法的子参数，不支持调节的算法不受影响，默认 default
 #zimg-scaler-chroma-param-b=1/3
 zimg-scaler=bicubic                # [zimg] 缩放算法，可用值参考 --zimg-scaler-chroma
 zimg-scaler-param-a=1/3            # [zimg] 缩放算法的子参数
 zimg-scaler-param-b=1/3
 #zimg-dither=error-diffusion       # [zimg] <no|ordered|random 默认|error-diffusion> 色深抖动算法
 zimg-fast=no                       # [zimg] 以质量为代价优化性能，默认 yes


[NNEDI3]
 profile-desc=适用于大多数场景
 glsl-shaders="~~/shaders/nnedi3/nnedi3-nns32-win8x4.glsl;~~/shaders/igv/adaptive-sharpen_luma.glsl"

[NNEDI3+]
 profile-desc=适用于大多数场景
 glsl-shaders="~~/shaders/nnedi3/nnedi3-nns64-win8x4.glsl;~~/shaders/igv/adaptive-sharpen_luma.glsl"

 [ravu-zoom]
 profile-desc=适用于大多数场景
 glsl-shaders="~~/shaders/ravu/ravu-zoom-ar-r3.glsl;~~/shaders/igv/adaptive-sharpen_luma.glsl"

[FSRCNNX]
 profile-desc=适用于 HD 场景
 glsl-shaders="~~/shaders/igv/FSRCNNX_x2_8-0-4-1.glsl;~~/shaders/igv/adaptive-sharpen_luma.glsl"

[FSRCNNX+]
 profile-desc=适用于 SD 场景
 glsl-shaders="~~/shaders/nnedi3/nnedi3-nns32-win8x4.glsl;~~/shaders/igv/FSRCNNX_x1_16-0-4-1_distort.glsl"

 [Ani4K]
 profile-desc=Ani4K
 profile-desc=适用于大多数动画
 glsl-shaders="~~/shaders/Ani4K/Ani4Kv2_ArtCNN_C4F32_i2.glsl"

[AniSD]
 profile-desc=AniSD
 profile-desc=适用于 SD 动画
 glsl-shaders="~~/shaders/Ani4K/AniSD_ArtCNN_C4F32_i4.glsl"

 [Anime4K]
 profile-desc=Anime4K
 profile-desc=适用于大多数动画
 glsl-shaders="~~/shaders/Anime4K/Anime4K_AIO_optQ.glsl"

[SSIM]
 profile-desc=适用于 4k 低性能
 glsl-shaders="~~/shaders/igv/SSimSuperRes.glsl;~~/shaders/igv/SSimDownscaler.glsl"



##############
# 条件配置组 #
##############

##⇘⇘条件触发配置，根据给定条件激发特定参数。简易格式见示例
##仅注释掉 --profile-cond 和 --profile-restore 即可将条件配置变为常规配置，常规配置的使用方法为通用区 --profile=<value>

##⇘⇘条件配置的格式示例
##[FS-loop]                                                  # 配置名称，自定义
##profile-desc    = 全屏时循环播放当前文件                   # 配置的描述，不属于参数，随意写
##profile-cond    = fullscreen                               # 触发该配置的条件。可用的属性列表 https://mpv.io/manual/master/#property-list
##profile-restore = copy                                     # 此参数一般用于回归触发前的通用参数（关闭此项将保留）
##...                                                        # 然后写该条件下触发的参数
##...

##⇘⇘文件名匹配的示例写法：根据文件名中的特定字符触发配置
##字符 "-" 需要使用 LUA 的转义符 "%"
#[VCB-Studio]
#profile-desc=真空断路器
#profile-cond=filename:find("VCB%-Studio")~=nil
#profile-restore=copy
#deband=no

[SD]
 profile-desc=低清源增强
 profile-cond=height <= 720 or width <= 720
 profile-restore=copy
 profile=FSRCNNX+

[Deband]
 profile-desc=YUV420P10 以下的源开启去色带
 profile-cond=get("video-params/average-bpp") < 24
 profile-restore=copy
 deband=yes

[hdr-2390]
 profile-cond=p.tone_mapping == "bt.2390" and p.current_vo == "gpu-next"
 profile-restore=copy
 tone-mapping-param=2.0

#[hdr-spline]
#profile-cond=p.tone_mapping == "spline"
#profile-restore=copy
#tone-mapping-param=1.0

[peak-percentile]
 profile-cond=get("video-params/avg-pq-y") < 0.21 and p.current_vo == "gpu-next"
 profile-restore=copy
 hdr-peak-percentile=99.8

[SDR-target]
 profile-desc=SDR 目标配置
 profile-cond=not get("video-params/max-luma") and not get("inverse-tone-mapping") and p.current_vo == "gpu-next"
 profile-restore=copy
 target-colorspace-hint=no

[HDR]
 profile-desc=HDR 配置
 profile-cond=get("video-params/max-luma") > 203
 profile-restore=copy
 target-peak=auto
 target-colorspace-hint=auto
 target-colorspace-hint-mode=target
 blend-subtitles=no
 deband=no
 vf=""

[HDR-PASS]
 profile-desc=HDR 直通参数，仅在 HDR 显示模式下生效
 profile-cond=get("video-params/max-luma") > 203 and get("video-target-params/max-luma") > 203 and p.current_vo == "gpu-next"
 profile-restore=copy
 icc-profile=""
 icc-profile-auto=no
 target-colorspace-hint=auto
 target-colorspace-hint-mode=target
 inverse-tone-mapping=no      # HDR 下不可启用反向映射功能
 target-prim=auto
 #target-gamut=dci-p3         # 或 adobe，用于 argb 色域
 target-trc=auto
 #target-contrast=auto        # 或可指定 HDR 显示器的对比度值，默认值会自动获取此信息
 #target-peak=auto            # 或可指定 HDR 显示器的峰值亮度值，默认值会自动获取此信息
 #sub-hdr-peak=100            # 用于调整 HDR 输出下的文本字幕亮度，越低的值越暗
 #image-subs-hdr-peak=10000   # 用于调整 HDR 输出下的图像字幕亮度，越高的值越暗，示例为最大值

[SDR-Gamut]
 profile-desc=SDR 内容的色域映射
 profile-cond=get("video-params/primaries") ~= "bt.709" and get("video-params/gamma") == "bt.1886"
 profile-restore=copy
 gamut-mapping-mode=clip

[video-sync]
 profile-desc=当音频调整速度超过阈值时改变音视频同步模式，以避免明显的音高变化
 profile-cond=(speed * audio_speed_correction) > 0 and ((speed * audio_speed_correction) < 0.96 or (speed * audio_speed_correction) > 1.04) and not (get("estimated-vf-fps") > 47 or get("display-fps") > 120)
 profile-restore=copy-equal
 video-sync=display-tempo

[fps-fix]
 profile-desc=修复视频帧率和显示刷新率过高引起的异常耗能或掉帧
 profile-cond=get("estimated-vf-fps") > 47 or get("display-fps") > 120
 profile-restore=copy
 video-sync=audio

[8k-fix]
 profile-desc=8k av1 下使用 d3d11va 硬解来解决掉帧问题，该方案仅限 --gpu-api=d3d11 下可用
 profile-cond=get("video-params/w") > 7000 or get("video-params/h") > 3000
 profile-restore=copy
 hwdec=auto-safe
 video-sync=audio

[pgs-fix]
 profile-desc=修复国内电影压制的内封 pgs 字幕画幅比例与视频不一致导致的字幕错位
 profile-cond=get("video-params/aspect") > 16 / 9
 profile-restore=copy
 stretch-image-subs-to-screen=yes

#[deinterlace]
# profile-desc=自动去交错
# profile-cond=get("video-frame-info/interlaced")
# profile-restore=copy
# deinterlace

#[audio-filter]
#副作用：蓝牙耳机切换时会导致持续的音视频不同步
# profile-desc=音频通道大于 2 时开启动态范围调节滤镜，适用于双通道设备
# profile-cond=get("audio-params/channel-count") > 2
# profile-restore=copy-equal
# af-pre=@dynaudnorm:lavfi=[dynaudnorm=f=500:g=31:p=0.5:m=5:r=0.9]

[pause]
 profile-desc=暂停时取消置顶
 profile-cond=pause
 profile-restore=copy
 ontop=no

#[fullscreen]
# profile-desc=全屏自动置顶
# profile-cond=fullscreen or window_maximized
# profile-restore=copy
# ontop

[maximized]
 profile-desc=最大化时取消窗口大小自动调整
 profile-cond=window_maximized and vid and not get("current-tracks/video/albumart")
 profile-restore=copy-equal
 auto-window-resize=no

[minimized]
 profile-desc=最小化时暂停
 profile-cond=window_minimized and vid and not get("current-tracks/video/albumart")
 profile-restore=copy-equal
 pause

[end]
 profile-desc=播放列表结束后退出全屏
 profile-cond=idle_active
 no-fullscreen
 no-window-maximized

[media-title]
 profile-desc=特殊协议下切换窗口标题显示内容
 profile-cond=path:find('://') ~= nil or path:find('^magnet:') ~= nil
 #profile-cond=demuxer_via_network == true
 profile-restore=copy
 title=${?pause==yes:⏸}${?mute==yes:🔇}${?ontop==yes:📌}${media-title}
 osd-playlist-entry=title

#[image]
# profile-desc=图像
# profile-cond=vid and not get("current-tracks/video/albumart") and estimated_frame_count <= 1
# profile-restore=copy
# prefetch-playlist
# image-display-duration=inf
# scale=ewa_hanning
# cscale=ewa_hanning
# dscale=mitchell

#[audio]
# profile-desc=音乐
# profile-cond=aid and (not vid or get("current-tracks/video/albumart"))
# profile-restore=copy
# prefetch-playlist
# loop-playlist=inf

 ##############
 # 传统配置组 #
 ##############
 
##⇘⇘中古版本的自动配置，功能有限一般不使用。语法见示例（可以转换为条件配置组写法）

##⇘⇘播放时检测符合条件的文件扩展名激活对应参数，不符合自动撤销
##[extension.扩展名]
##不要写 --profile-cond 和 --profile-restore
##... # 直接写参数即可

#[extension.vpy]
#profile-desc=支持 "xxxx.vpy" 文件的预览
#demuxer-lavf-format=vapoursynth

##⇘⇘播放时检测符合条件的协议激活对应参数，不符合自动撤销
##[protocol.协议名]	
##不要写 --profile-cond 和 --profile-restore
##... # 直接写参数即可

#[protocol.https]
#profile-desc=https 协议下切换显示内容
#osd-playing-msg='${media-title} ${!chapters==0:章节:${chapter}/${chapters}} ${!playlist-count==1:列表:${playlist-pos-1}/${playlist-count}}'
#script-opts-append=osc_lazy-title=${media-title} ${!chapters==0:章节:${chapter}/${chapters}} ${!playlist-count==1:列表:${playlist-pos-1}/${playlist-count}}

##⇘⇘配合 display-name.lua 脚本实现 mpv 窗口按显示器名称自动切换参数及配置文件（仅限 Windows），依赖 MultiMonitorTool.exe
#[TV]
#profile-cond=get("user-data/display_name") == 'VX2771-4K-HD'
#profile-restore=copy-equal
#dither-depth=10
#inverse-tone-mapping=yes
#target-colorspace-hint=yes
#script-opts-append=changerefresh-auto=yes
#script-opts-append=changerefresh-rates=23;24;25-50;29-59;30-60;50;59;60